import{r as ur}from"../chunks/EF4Pp1i4.js";import"../chunks/NZTpNUN0.js";import"../chunks/BBjpR9ww.js";import{p as pr,l as fr,a2 as _r,c as a,af as k,ac as d,aa as i,g as r,ab as o,a9 as S,w as mr,a8 as gr}from"../chunks/B7pVfImq.js";import{e as Y,s as E}from"../chunks/C49klihd.js";import{i as x,s as kr,a as W}from"../chunks/C_PPKRUY.js";import{e as hr,i as br}from"../chunks/BWaKuXpU.js";import{t as f,h as wr,a as p}from"../chunks/C7ddXOl0.js";import{r as qr,p as yr,s as X}from"../chunks/BQhN11bg.js";import{s as Cr}from"../chunks/C3auQ9ac.js";import{b as Er}from"../chunks/CQi3uyDk.js";import{i as xr}from"../chunks/DcBDN0ri.js";import{g as Z}from"../chunks/BYdse5x5.js";import{a as rr,s as z}from"../chunks/C2mqf3jC.js";import{o as Pr}from"../chunks/BHCZFSv4.js";const $r="remyremy";function Ir(P){return P===$r}const Ur=!1;function Lr({url:P}){const $=P.searchParams.get("token");if(!$||!Ir($))throw ur(303,"/error");return{token:$}}const et=Object.freeze(Object.defineProperty({__proto__:null,load:Lr,prerender:Ur},Symbol.toStringTag,{value:"Module"}));var Mr=f('<meta name="description" content="Your card collection">'),Sr=f('<div class="login-prompt svelte-1tqkg55"><p>Please log in to view and unlock cards.</p> <button class="svelte-1tqkg55">Go to Login</button></div>'),Yr=f("<p>Loading cards...</p>"),Ar=f('<p class="error svelte-1tqkg55"> </p>'),Or=f('<p> </p> <span class="rarity svelte-1tqkg55"> </span>',1),Tr=f('<div><img class="svelte-1tqkg55"> <div class="card-info svelte-1tqkg55"><h3> </h3> <!></div></div>'),jr=f('<div class="cards-grid svelte-1tqkg55"></div>'),zr=f('<p class="error svelte-1tqkg55"> </p>'),Dr=f('<div class="modal-overlay svelte-1tqkg55"><div class="modal svelte-1tqkg55"><h2>Unlock Card</h2> <p>Enter the password to unlock this card:</p> <div class="debug-info svelte-1tqkg55"><p><strong>Debug - Card Password:</strong> </p></div> <input type="password" placeholder="Enter password" class="svelte-1tqkg55"> <!> <div class="modal-buttons svelte-1tqkg55"><button class="svelte-1tqkg55">Unlock</button> <button class="cancel svelte-1tqkg55">Cancel</button></div></div></div>'),Fr=f('<div class="container svelte-1tqkg55"><h1>Your Card Collection</h1> <!> <!></div>');function st(P,$){pr($,!1);const[G,tr]=kr(),_=()=>W(rr,"$auth",G),K=()=>W(yr,"$page",G);let N=k([]),c=k(new Set),h=k(null),I=k(""),b=k(""),q=k(""),A=k(!1),B=k(!0);const ar="https://picsum.photos/400/300?blur=10";Pr(async()=>{try{rr.initialize();const{data:t,error:e}=await z.from("cards").select("*");if(e)throw e;if(t&&a(N,t),_().userId){const{data:n,error:m}=await z.from("user_cards").select("card_id").eq("user_id",_().userId);if(m)throw m;n&&a(c,new Set(n.map(v=>v.card_id)))}}catch(t){console.error("Error loading cards:",t),a(q,"Failed to load cards")}finally{a(B,!1)}});function er(t){if(!_().isAuthenticated){a(q,"Please log in first");return}a(h,t),a(I,""),a(b,""),a(A,!0)}function H(t){if(!_().userId){a(q,"Please log in first");return}if(!r(c).has(t)){a(q,"You need to unlock this card first");return}const e=K().url.searchParams.get("token");Z(`/card/${t}?token=${e}`)}async function J(){if(!_().userId){a(b,"Please log in first");return}try{if(r(h).unlock_password!==r(I)){a(b,"Incorrect password"),a(I,"");return}const{data:t,error:e}=await z.from("user_cards").select("id").eq("user_id",_().userId).eq("card_id",r(h).id).limit(1);if(e)throw e;if(t&&t.length>0){a(b,"You already have this card!");return}const{error:n}=await z.from("user_cards").insert({user_id:_().userId,card_id:r(h).id});if(n)throw n;r(c).add(r(h).id),a(c,r(c)),a(A,!1),H(r(h).id)}catch(t){console.error("Unlock error:",t),a(b,"Failed to unlock card")}}xr();var D=Fr();wr(t=>{var e=Mr();_r.title="Card Collection",p(t,e)});var Q=d(i(D),2);{var sr=t=>{var e=Sr(),n=d(i(e),2);o(e),Y("click",n,()=>Z(`/?token=${K().url.searchParams.get("token")}`)),p(t,e)},or=(t,e)=>{{var n=v=>{var U=Yr();p(v,U)},m=(v,U)=>{{var y=g=>{var u=Ar(),C=i(u,!0);o(u),S(()=>E(C,r(q))),p(g,u)},O=g=>{var u=jr();hr(u,5,()=>r(N),br,(C,s)=>{var l=Tr(),w=i(l),T=d(w,2),F=i(T),nr=i(F,!0);o(F);var dr=d(F,2);{var cr=L=>{var j=Or(),M=gr(j),V=i(M,!0);o(M);var R=d(M,2),vr=i(R,!0);o(R),S(()=>{E(V,r(s).description),E(vr,r(s).rarity)}),p(L,j)};x(dr,L=>{r(c).has(r(s).id)&&L(cr)})}o(T),o(l),S((L,j,M,V)=>{Cr(l,1,`card ${L??""}`,"svelte-1tqkg55"),X(w,"src",j),X(w,"alt",M),E(nr,V)},[()=>r(c).has(r(s).id)?"unlocked":"locked",()=>r(c).has(r(s).id)?r(s).image_url:ar,()=>r(c).has(r(s).id)?r(s).name:"Locked card",()=>r(c).has(r(s).id)?r(s).name:"???"],mr),Y("click",l,()=>r(c).has(r(s).id)?H(r(s).id):er(r(s))),p(C,l)}),o(u),p(g,u)};x(v,g=>{r(q)?g(y):g(O,!1)},U)}};x(t,v=>{r(B)?v(n):v(m,!1)},e)}};x(Q,t=>{_().isAuthenticated?t(or,!1):t(sr)})}var ir=d(Q,2);{var lr=t=>{var e=Dr(),n=i(e),m=d(i(n),4),v=i(m),U=d(i(v));o(v),o(m);var y=d(m,2);qr(y);var O=d(y,2);{var g=l=>{var w=zr(),T=i(w,!0);o(w),S(()=>E(T,r(b))),p(l,w)};x(O,l=>{r(b)&&l(g)})}var u=d(O,2),C=i(u),s=d(C,2);o(u),o(n),o(e),S(()=>E(U,` ${r(h).unlock_password??""}`)),Er(y,()=>r(I),l=>a(I,l)),Y("keydown",y,l=>l.key==="Enter"&&J()),Y("click",C,J),Y("click",s,()=>a(A,!1)),p(t,e)};x(ir,t=>{r(A)&&t(lr)})}o(D),p(P,D),fr(),tr()}export{st as component,et as universal};
