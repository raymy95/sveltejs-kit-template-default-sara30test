import"../chunks/EF4Pp1i4.js";import"../chunks/NZTpNUN0.js";import{p as Qa,Y as Wa,l as $a,a9 as h,g as a,a2 as Ha,ad as q,aa as r,ab as t,c as v,ac as o,a8 as ha,ae as Ja}from"../chunks/B7pVfImq.js";import{s as u,e as sa}from"../chunks/C49klihd.js";import{i as _,s as Ka,a as ma}from"../chunks/C_PPKRUY.js";import{e as Ua,i as Va}from"../chunks/BWaKuXpU.js";import{t as c,h as Xa,a as l}from"../chunks/C7ddXOl0.js";import{p as Za,s as ya}from"../chunks/BQhN11bg.js";import{s as ga}from"../chunks/C3auQ9ac.js";import{p as oa}from"../chunks/hx4sYJXw.js";import{o as ae}from"../chunks/BHCZFSv4.js";import{a as ja,s as ia}from"../chunks/C2mqf3jC.js";import{g as la}from"../chunks/BYdse5x5.js";const ee=!1;function te({params:L}){return{cardId:L.slug}}const Ee=Object.freeze(Object.defineProperty({__proto__:null,load:te,prerender:ee},Symbol.toStringTag,{value:"Module"}));var re=c('<meta name="description" content="Card detail view" class="svelte-12a0hyj">'),se=c('<div class="loading svelte-12a0hyj"><p class="svelte-12a0hyj">Loading card...</p></div>'),oe=c('<div class="error-container svelte-12a0hyj"><p class="error svelte-12a0hyj"> </p> <button class="back-button svelte-12a0hyj">← Back to Collection</button></div>'),ie=c('<div class="loading svelte-12a0hyj"><p class="svelte-12a0hyj">Initializing...</p></div>'),le=c(`<div class="already-answered svelte-12a0hyj"><p class="svelte-12a0hyj">You've already answered this question correctly!</p> <p class="svelte-12a0hyj"> </p> <p class="svelte-12a0hyj"> </p></div>`),ce=c('<span class="loading-indicator svelte-12a0hyj">...</span>'),ne=c("<button> <!></button>"),ve=c('<div><p class="svelte-12a0hyj"> </p></div>'),de=c('<p class="points-info svelte-12a0hyj"> </p>'),ue=c('<div class="answers svelte-12a0hyj"></div> <!> <div class="wrong-answers svelte-12a0hyj"><p class="svelte-12a0hyj"> </p> <!></div>',1),_e=c('<div class="question-section svelte-12a0hyj"><h2 class="svelte-12a0hyj">Question:</h2> <p class="question svelte-12a0hyj"> </p> <!></div>'),pe=c('<button class="back-button svelte-12a0hyj">← Back to Collection</button> <div class="card-detail svelte-12a0hyj"><img class="svelte-12a0hyj"> <div class="card-info svelte-12a0hyj"><h1 class="svelte-12a0hyj"> </h1> <p class="description svelte-12a0hyj"> </p> <span class="rarity svelte-12a0hyj"> </span></div></div> <!>',1),fe=c('<div class="container svelte-12a0hyj"><!></div>');function Me(L,g){Qa(g,!0);const[ca,wa]=Ka(),p=()=>ma(ja,"$auth",ca),N=()=>ma(Za,"$page",ca);let n=q(null),Q=q(!0),b=q(null),W=[],R=null,x=!1,j=!1,Y=q(!1),A=!1,w=q(!1),m=q(0);async function ba(){if(!(!A||!p().isAuthenticated||!p().userId||!g.data.cardId))try{v(Q,!0),v(b,null);const{data:e,error:i}=await ia.from("cards").select("*").eq("id",g.data.cardId).single();if(i)throw i;if(!e){v(b,"Card not found");return}const{data:E,error:M}=await ia.from("user_cards").select("*").eq("user_id",p().userId).eq("card_id",g.data.cardId).single();if(M&&M.code!=="PGRST116")throw M;if(!E){la(`/collection?token=${N().url.searchParams.get("token")}`);return}v(Y,oa(E.answered_correctly||!1)),v(m,oa(E.wrong_answers||0)),e.question&&e.correct_answer&&!a(Y)&&(W=[{text:e.correct_answer,isCorrect:!0},{text:e.wrong_answer_1,isCorrect:!1},{text:e.wrong_answer_2,isCorrect:!1},{text:e.wrong_answer_3,isCorrect:!1}].sort(()=>Math.random()-.5)),v(n,oa(e))}catch(e){console.error("Error loading card:",e),v(b,"Failed to load card")}finally{v(Q,!1)}}async function xa(e){if(!(!p().userId||!g.data.cardId||a(w)))try{v(w,!0),R=e,j=e.isCorrect,x=!0,j||Ja(m);const{error:i}=await ia.rpc("update_card_score",{user_id_param:p().userId,card_id_param:g.data.cardId,is_correct:j});if(i)throw i;j&&v(Y,!0)}catch(i){console.error("Error updating score:",i),v(b,"Failed to update score")}finally{v(w,!1)}}function na(){la(`/collection?token=${N().url.searchParams.get("token")}`)}ae(()=>{ja.initialize(),A=!0}),Wa(()=>{A&&p().isAuthenticated&&p().userId&&g.data.cardId?ba():A&&!p().isAuthenticated&&la(`/?token=${N().url.searchParams.get("token")}`)});var $=fe();Xa(e=>{var i=re();h(()=>Ha.title=`${(a(n)?a(n).name:"Card")??""} - Card Collection`),l(e,i)});var Ca=r($);{var ka=e=>{var i=se();l(e,i)},Ia=(e,i)=>{{var E=C=>{var P=oe(),z=r(P),H=r(z,!0);t(z);var y=o(z,2);t(P),h(()=>u(H,a(b))),sa("click",y,na),l(C,P)},M=(C,P)=>{{var z=y=>{var J=ie();l(y,J)},H=(y,J)=>{{var qa=K=>{var va=pe(),da=ha(va),U=o(da,2),V=r(U),ua=o(V,2),X=r(ua),Aa=r(X,!0);t(X);var Z=o(X,2),Ea=r(Z,!0);t(Z);var _a=o(Z,2),Ma=r(_a,!0);t(_a),t(ua),t(U);var Pa=o(U,2);{var za=aa=>{var ea=_e(),ta=o(r(ea),2),Ta=r(ta,!0);t(ta);var Ba=o(ta,2);{var Sa=k=>{var T=le(),B=o(r(T),2),S=r(B);t(B);var D=o(B,2),F=r(D);t(D),t(T),h(()=>{u(S,`The correct answer is: ${a(n).correct_answer??""}`),u(F,`It took you ${a(m)??""} wrong ${(a(m)===1?"attempt":"attempts")??""} before getting it right.`)}),l(k,T)},Da=(k,T)=>{{var B=S=>{var D=ue(),F=ha(D);Ua(F,21,()=>W,Va,(f,s)=>{var d=ne();let I;var G=r(d),Ga=o(G);{var La=O=>{var Na=ce();l(O,Na)};_(Ga,O=>{a(w)&&R===a(s)&&O(La)})}t(d),h(O=>{I=ga(d,1,"answer-button svelte-12a0hyj",null,I,O),d.disabled=x||a(w),u(G,`${a(s).text??""} `)},[()=>({selected:R===a(s),correct:x&&a(s).isCorrect,incorrect:x&&R===a(s)&&!a(s).isCorrect,updating:a(w)})]),sa("click",d,()=>!x&&!a(w)&&xa(a(s))),l(f,d)}),t(F);var pa=o(F,2);{var Fa=f=>{var s=ve();ga(s,1,"result svelte-12a0hyj",null,{},{correct:j,incorrect:!j});var d=r(s),I=r(d,!0);t(d),t(s),h(G=>u(I,G),[()=>j?`Correct! +${5-Math.min(a(m),4)} points`:"Incorrect! Try again!"]),l(f,s)};_(pa,f=>{x&&f(Fa)})}var fa=o(pa,2),ra=r(fa),Oa=r(ra);t(ra);var Ra=o(ra,2);{var Ya=f=>{var s=de(),d=r(s);t(s),h(I=>u(d,`Next correct answer will give you ${I??""} points`),[()=>5-Math.min(a(m),4)]),l(f,s)};_(Ra,f=>{a(m)>0&&f(Ya)})}t(fa),h(()=>u(Oa,`Wrong attempts: ${a(m)??""}`)),l(S,D)};_(k,S=>{W.length>0&&S(B)},T)}};_(Ba,k=>{a(Y)?k(Sa):k(Da,!1)})}t(ea),h(()=>u(Ta,a(n).question)),l(aa,ea)};_(Pa,aa=>{a(n).question&&aa(za)})}h(()=>{ya(V,"src",a(n).image_url),ya(V,"alt",a(n).name),u(Aa,a(n).name),u(Ea,a(n).description),u(Ma,a(n).rarity)}),sa("click",da,na),l(K,va)};_(y,K=>{a(n)&&K(qa)},J)}};_(C,y=>{!A||!p().isAuthenticated?y(z):y(H,!1)},P)}};_(e,C=>{a(b)?C(E):C(M,!1)},i)}};_(Ca,e=>{a(Q)?e(ka):e(Ia,!1)})}t($),l(L,$),$a(),wa()}export{Me as component,Ee as universal};
